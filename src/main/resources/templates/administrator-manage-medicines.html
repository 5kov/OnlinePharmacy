<!DOCTYPE html>
<html lang="en">
<head th:replace="fragments/commons::head"></head>
<body>
<div class="container">
    <header th:replace="fragments/commons::header"></header>

    <div class="form">
        <h1>Administrator Page</h1>
        <h3>Manage medicines</h3>
        <div class="input-container">
            <form th:action="@{/administrator-manage-medicines}" method="get">
                <input type="text" class="input-field" name="search" placeholder="Search by Name"/>
                <button type="submit" class="button">Search</button>
            </form>

            <div th:each="medicine : ${medicines}">
                <p th:text="${medicine.medicineNameEn}"></p>
                <button th:attr="onclick='javascript:editMedicine(' + ${medicine.id} + ');'" class="button">Edit</button>
                <form th:action="@{/delete/{id}(id=${medicine.id})}" method="post">
                    <button type="submit" class="button">Delete</button>
                </form>
            </div>

            <!-- Edit Form -->
            <form id="editForm" th:action="@{/save}" method="post" style="display:none;">
                <input type="hidden" id="id" name="id"/>
                <label for="medicineNameEn">Medicine Name (English):</label>
                <input type="text" class="input-field" id="medicineNameEn" name="medicineNameEn" placeholder="Medicine Name (English)"/>
                <label for="medicineNameBg">Medicine Name (Bulgarian):</label>
                <input type="text" class="input-field" id="medicineNameBg" name="medicineNameBg" placeholder="Medicine Name (Bulgarian)"/>
                <label for="price">Price:</label>
                <input type="number" class="input-field" step="0.01" id="price" name="price" placeholder="Price"/>
                <label for="descriptionEn">Description (English):</label>
                <input type="text" class="input-field" id="descriptionEn" name="descriptionEn" placeholder="Description (English)"/>
                <label for="descriptionBg">Description (Bulgarian):</label>
                <input type="text" class="input-field" id="descriptionBg" name="descriptionBg" placeholder="Description (Bulgarian)"/>
                <label for="imageUrl">Image URL:</label>
                <input type="text" class="input-field" id="imageUrl" name="imageUrl" placeholder="Image URL"/>
                <label for="activeIngredientId">Active Ingredient:</label>
                <select id="activeIngredientId" class="input-field" name="activeIngredientId">
                    <option value="">-- Select Active Ingredient --</option>
                    <option th:each="ingredient : ${ingredients}" th:value="${ingredient.id}" th:text="${ingredient.ingredientName}"></option>
                </select>
                <button type="submit" class="button">Save Changes</button>
            </form>

            <script>
                function editMedicine(id) {
                    fetch(`/data/${id}`)
                        .then(response => {
                            if (response.ok) return response.json();
                            throw new Error('Network response was not ok.');
                        })
                        .then(data => {
                            const form = document.getElementById('editForm');
                            form.style.display = 'block';
                            document.getElementById('id').value = data.id;
                            document.getElementById('medicineNameEn').value = data.medicineNameEn;
                            document.getElementById('medicineNameBg').value = data.medicineNameBg;
                            document.getElementById('price').value = data.price;
                            document.getElementById('descriptionEn').value = data.descriptionEn;
                            document.getElementById('descriptionBg').value = data.descriptionBg;
                            document.getElementById('imageUrl').value = data.imageUrl;
                            const activeIngredientSelect = document.getElementById('activeIngredientId');
                            activeIngredientSelect.value = data.activeIngredientId;
                        })
                        .catch(error => {
                            console.error('Error fetching the medicine data:', error);
                            alert('Failed to load medicine data.');
                        });
                }
            </script>
        </div>
    </div>






        <footer th:replace="fragments/commons::footer"></footer>
</div>
</body>
</html>